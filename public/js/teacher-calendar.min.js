var start_var;
var end_var;
$(document).ready(function () {
    var calendar = $("#cal");
    calendar.fullCalendar({
        lang: "DE",
        timezone: "local",
        header: {right: "prev,today,next", center: "month,agendaWeek,agendaDay,listWeek"},
        weekNumbers: true,
        defaultView: "agendaWeek",
        selectable: true,
        selectHelper: true,
        allDaySlot: false,
        contentHeight: 600,
        scrollTime: "10:00:00",
        timeFormat: "H:mm",
        slotLabelFormat: "H:mm",
        slotDuration: "00:30:00",
        select: function (start, end, jsevent) {
            for (timestamp_start = moment(start); timestamp_start < moment(end); timestamp_start) {
                start_var = timestamp_start.format("YYYY-MM-DD HH:mm");
                end_var = timestamp_start.add(.5, "hours").format("YYYY-MM-DD HH:mm");
                prepareForDatabase(start_var, end_var, jsevent, "teacher-create")
            }
        },
        eventClick: function (calEvent, jsEvent, view) {
            if (calEvent.className.indexOf("blocked") > 0) {
                writeFlashmessage("Der Termin wurde von einem Schüler gebucht und kann nicht gelöscht werden. Bitte kontaktiere den Schüler.")
            } else {
                prepareForDatabase(calEvent._start._d, calEvent._end._d, jsEvent, "teacher-delete")
            }
        }
    });
    $.ajax({
        method: "POST",
        url: "../src/ajax/AjaxHandler.php",
        data: {action: "teacher-read", p: "manage-calendar", id: user.id},
        beforeSend: function () {
            writeFlashmessage("Kalendertermine werden geladen.")
        }
    }).done(function (result) {
        writeFlashmessage("Kalendertermine erfolgreich geladen.");
        fetchEvents(result)
    })
});
